#!/bin/bash

set -e

NYANPASS_DIR="$(dirname "$(readlink -f "$0")")"
NYANPASS_URL="http://nyanpass.com/count$[$RANDOM%1000+1]"

curl "$NYANPASS_URL" \
  -H 'Host: nyanpass.com' \
  -H 'User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_9_3) AppleWebKit/537.75.14 (KHTML, like Gecko) Version/7.0.3 Safari/537.75.14' \
  -H 'Accept: */*' \
  -H 'Accept-Language: ja,en-us;q=0.7,en;q=0.3' \
  --compressed \
  -H 'Content-Type: application/x-www-form-urlencoded; charset=UTF-8' \
  -H 'x-requested-with: XMLHttpRequest' \
  -H 'Referer: http://nyanpass.com/' \
  -H 'Connection: keep-alive' \
  -H 'Pragma: no-cache' \
  -H 'Cache-Control: no-cache' \
  --data 'ck=1' && echo

if [[ -z "$MP3_PLAYER" ]]; then
  for mp3_player in afplay mplayer mpg123 mpg321; do
    if type "$mp3_player" >&/dev/null; then
      MP3_PLAYER="$mp3_player"
      break
    fi
  done
fi

"$MP3_PLAYER" "$NYANPASS_DIR/nyanpass.mp3" >&/dev/null
